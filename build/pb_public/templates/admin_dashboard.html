<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disciplo Admin</title>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; line-height: 1.6; color: #333; background: #f8f9fa; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
        .header { background: white; border-bottom: 1px solid #e9ecef; padding: 1rem 0; }
        .nav { display: flex; gap: 2rem; margin-top: 1rem; }
        .nav button { background: none; border: none; padding: 0.5rem 1rem; cursor: pointer; border-bottom: 2px solid transparent; }
        .nav button.active { border-bottom-color: #333; font-weight: 600; }
        .main { padding: 2rem 0; }
        .card { background: white; border-radius: 8px; padding: 2rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 2rem; }
        .btn { background: #333; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; text-decoration: none; display: inline-block; }
        .btn:hover { background: #555; }
        .btn-secondary { background: #6c757d; }
        .table { width: 100%; border-collapse: collapse; }
        .table th, .table td { text-align: left; padding: 0.75rem; border-bottom: 1px solid #e9ecef; }
        .table th { font-weight: 600; background: #f8f9fa; }
        .status { padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.875rem; }
        .status.pending { background: #fff3cd; color: #856404; }
        .status.accepted { background: #d1edff; color: #084298; }
        .telegram-connect { background: #0088cc; color: white; padding: 1rem; border-radius: 8px; margin: 1rem 0; }
        @media (max-width: 768px) {
            .nav { flex-direction: column; gap: 0; }
            .table { font-size: 0.875rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h1>Disciplo Admin</h1>
                <button class="btn btn-outline" onclick="logout()" style="padding: 0.5rem 1rem; font-size: 0.9rem;">Sign Out</button>
            </div>
            <nav class="nav" x-data="{ activeTab: 'profile' }">
                <button :class="activeTab === 'profile' ? 'active' : ''" @click="activeTab = 'profile'">Profile</button>
                <button :class="activeTab === 'groups' ? 'active' : ''" @click="activeTab = 'groups'">Communities</button>
                <button :class="activeTab === 'members' ? 'active' : ''" @click="activeTab = 'members'">Members</button>
            </nav>
        </div>
    </div>

    <div class="main">
        <div class="container" x-data="adminDashboard()">
            <!-- Profile Tab -->
            <div x-show="activeTab === 'profile'" class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2>Admin Profile</h2>
                    <button class="btn btn-secondary" @click="editMode = !editMode" x-text="editMode ? 'Cancel' : 'Edit Profile'">Edit Profile</button>
                </div>
                
                <div x-show="!editMode">
                    <div style="display: grid; gap: 1rem; max-width: 600px;">
                        <div><strong>Name:</strong> {{.AdminName}}</div>
                        <div><strong>Email:</strong> {{.AdminEmail}}</div>
                        <div><strong>Status:</strong> <span class="status accepted">Admin</span></div>
                        <div><strong>Verified:</strong> <span x-text="telegramConnected ? 'Yes' : 'No'"></span></div>
                    </div>
                </div>
                
                <div x-show="editMode" style="max-width: 600px;">
                    <form @submit.prevent="saveProfile">
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Name</label>
                            <input type="text" x-model="profileForm.name" class="form-input" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;">
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Email (read-only)</label>
                            <input type="email" :value="profileForm.email" disabled class="form-input" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px; background: #f8f9fa; color: #666;">
                        </div>
                        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                            <button type="submit" class="btn" :disabled="loading">Save Changes</button>
                            <button type="button" class="btn btn-secondary" @click="showPasswordChange = !showPasswordChange">Change Password</button>
                        </div>
                    </form>
                    
                    <div x-show="showPasswordChange" style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e9ecef;">
                        <h3 style="margin-bottom: 1rem;">Change Password</h3>
                        <form @submit.prevent="changePassword">
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Current Password</label>
                                <input type="password" x-model="passwordForm.current" class="form-input" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;" required>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">New Password</label>
                                <input type="password" x-model="passwordForm.new" class="form-input" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;" required>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Confirm New Password</label>
                                <input type="password" x-model="passwordForm.confirm" class="form-input" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;" required>
                            </div>
                            <button type="submit" class="btn" :disabled="passwordLoading">Update Password</button>
                        </form>
                    </div>
                </div>
                
                <div x-show="!telegramConnected">
                    <div style="background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 1rem; border-radius: 6px; margin: 1rem 0;">
                        <p><strong>⏳ Telegram Not Connected</strong></p>
                        <p>Connect your Telegram account: <a href="{{.TelegramLink}}" target="_blank" style="color: #856404; text-decoration: underline;">Link Account</a></p>
                    </div>
                </div>
                
                <div x-show="telegramConnected">
                    <div style="background: #d1edff; border: 1px solid #b6d7ff; color: #084298; padding: 1rem; border-radius: 6px; margin: 1rem 0;">
                        <p><strong>✅ Telegram Connected</strong></p>
                        <p>Account linked. <a href="{{.TelegramLink}}" target="_blank" style="color: #084298; text-decoration: underline; font-size: 0.9rem;">Relink with different account</a></p>
                    </div>
                </div>
            </div>

            <!-- Communities Tab -->
            <div x-show="activeTab === 'groups'" class="card">
                <h2>Communities</h2>
                <p class="text-muted">Community groups will be managed here in future phases.</p>
                
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>General Community</td>
                            <td>Default</td>
                            <td><span class="status pending">Setup Required</span></td>
                            <td>
                                <button class="btn btn-secondary" disabled>Configure</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Members Tab -->
            <div x-show="activeTab === 'members'" class="card">
                <h2>Members</h2>
                <p class="text-muted">Member onboarding will be available in future phases.</p>
                
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Telegram</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>{{.AdminName}}</td>
                            <td>{{.AdminEmail}}</td>
                            <td><span class="status accepted">Admin</span></td>
                            <td><span x-text="telegramConnected ? '✅ Connected' : '⏳ Pending'"></span></td>
                            <td>-</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        function adminDashboard() {
            return {
                activeTab: 'profile',
                telegramConnected: false,
                editMode: false,
                showPasswordChange: false,
                loading: false,
                passwordLoading: false,
                profileForm: {
                    name: '{{.AdminName}}',
                    email: '{{.AdminEmail}}'
                },
                passwordForm: {
                    current: '',
                    new: '',
                    confirm: ''
                },
                
                init() {
                    this.checkTelegramStatus();
                },
                
                async checkTelegramStatus() {
                    try {
                        const response = await fetch('/api/admin/telegram-status');
                        const data = await response.json();
                        this.telegramConnected = data.connected;
                    } catch (error) {
                        this.telegramConnected = false;
                    }
                },
                
                async saveProfile() {
                    this.loading = true;
                    // Profile update will be implemented when we add the API endpoints
                    setTimeout(() => {
                        this.loading = false;
                        this.editMode = false;
                        alert('Profile updated successfully!');
                    }, 1000);
                },
                
                async changePassword() {
                    if (this.passwordForm.new !== this.passwordForm.confirm) {
                        alert('New passwords do not match!');
                        return;
                    }
                    
                    this.passwordLoading = true;
                    // Password change will be implemented when we add the API endpoints
                    setTimeout(() => {
                        this.passwordLoading = false;
                        this.showPasswordChange = false;
                        this.passwordForm = { current: '', new: '', confirm: '' };
                        alert('Password changed successfully!');
                    }, 1000);
                }
            }
        }
        
        function logout() {
            localStorage.removeItem('authToken');
            window.location.replace('/login');
        }
    </script>
</body>
</html>